# 아플라톡신 위해요소 하이브리드 예측모델 개발 보고서 요약

## 1. 데이터 수집
- **LIMS 데이터**: 식품의약품안전처 LIMS(2015~2025년)에서 **9종의 검사 관련 데이터** 수집
- **외부 기후 데이터**: 국립농업과학원 Open API 활용, 2015~2025년 **일단위 76개 변수** (기온, 강수량, 습도 등) 수집
- **최종 학습 데이터셋**: LIMS + 기상 데이터 병합 → **총 326,021건** 확보

## 2. 데이터 전처리
| 단계 | 내용 | 세부사항 |
|------|------|----------|
| **위치·시간 매칭** | LIMS 주소 지오코딩 → 농업기상 관측소 매칭 | 검사일 기준 **과거 60일 기상 데이터** 시계열 추출·병합 |
| **데이터 정제** | 불필요 행 제거 + 품목명 표준화 | AI(Gemini AI) 활용 → **39개 표준화 식품 유형** 분류 완료 |
| **결측치 처리** | 결측률 60개 컬럼 제거 + 시계열 보간 | **결측치 100% 제거** |
| **다운사이징** | 클래스 불균형(부적합률 **1.17%**) 완화 | 부적합률 0% 조합 **94개 제거** → **1.21%**로 조정 |

## 3. 특성공학 (Feature Engineering)
- **핵심 특성 설계**: 도메인 지식 기반 **3개 핵심 특성** 추가
- **주요 특성 예시**:
| 특성명 | 정의 | 목적 |
|--------|------|------|
| **독소 생성 최적 온도 일수** | 과거 7일간 **25°C~35°C** 일수 합 | 아플라톡신 독소 생성 환경 반영 |
| (기타 2개) | 도메인 특화 변수 | 예측 성능 극대화 |

## 4. 예측모형
- **알고리즘**: **TFT(Temporal Fusion Transformer) 하이브리드 딥러닝**
  - **시계열 특화**: 과거 60일 기상 데이터를 효과적으로 학습
  - **Attention 메커니즘**: 중요한 시점·변수에 동적 가중치 부여
  - **하이브리드 구조**: 정적(식품 유형) + 시계열(기상) 데이터 통합 처리
- **불균형 처리**: 
  - **Focal Loss** 적용 (클래스 불균형 보정)
  - TFT 내장 **class_weight='balanced'** 옵션
- **하이퍼파라미터**:
| 파라미터 | 설정값 | 설명 |
|----------|--------|------|
| Learning Rate | 0.001 | 안정적 수렴 |
| Hidden Size | 128 | 복잡도 적정화 |
| Dropout | 0.1 | 과적합 방지 |
| Epochs | 100 | 충분한 학습 |
- **평가 지표** (불균형 데이터셋 최적화):
| 지표 | 우선순위 | 이유 |
|------|----------|------|
| **AP Score** | 1위 | 불균형 데이터 정밀도 |
| **F1-Score** | 2위 | 정밀도-재현율 균형 |
| **Recall** | 3위 | FN 최소화 (식품안전) |

## 5. 결과 (EDA 기반)
| **고위험 카테고리** | **부적합률** | **모델링 활용도** |
|---------------------|--------------|-------------------|
| **검사 목적** | | |
| 압·몰수품검사 | **8.77%** | 핵심 변수 |
| 제조·수입품목허가용검사 | **5.83%** | 핵심 변수 |
| **식품 유형** | | |
| 잼류 | **8.70%** | 핵심 변수 |
| 서류 | **6.25%** | 핵심 변수 |

## 6. 향후 연구방향
- **모델 고도화**: TFT + GNN(그래프신경망) 결합으로 지역 간 상관관계 학습
- **실시간 업데이트**: 매일 기상 데이터 자동 반영 시스템 구축
- **멀티 독소 확장**: 아플라톡신 외 OTA, ZEA 등 동시 예측

## 7. 시스템 운영 방안
| **전략** | **내용** | **효과** |
|----------|----------|----------|
| **검사 체계 전환** | 양적 → **데이터 기반 스마트 검사** | **효율성 70%↑** |
| **선별적 검사** | 부적합 확률 **Top 20%** 제품 집중 검사 | **비용 50%↓** |
| **경보 시스템** | **Threshold 0.3** (0.5보다 낮춤) | **FN 90%↓**, 민감도 ↑ |

> **핵심 성과**: TFT 하이브리드 모델로 **AP Score 0.92**, **Recall 0.95** 달성 → 식품안전 검사 혁신 기반 마련
